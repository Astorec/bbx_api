 SELECT
                ROW_NUMBER() OVER (ORDER BY SUM(td.score) DESC,
                                            ROUND(
                                            CASE
                                            WHEN SUM(td.wins) + SUM(td.losses) = 0 THEN 0.0
                                            ELSE (SUM(td.wins) * 100.0) / (SUM(td.wins) + SUM(td.losses))
                                            END
                                            ) DESC
                                ) AS player_rank,
                COALESCE(p.username, p.name) AS display_name,
                SUM(td.score) AS total_score,        
                ROUND(
                CASE
                WHEN SUM(td.wins) + SUM(td.losses) = 0 THEN 0.0
                ELSE (SUM(td.wins) * 100.0) / (SUM(td.wins) + SUM(td.losses))
                END
                ) AS total_win_percentage,
                r.region
            FROM
                tblTournamentData td
            JOIN
                tblPlayers p ON td.player_db_id = p.id
            JOIN
                tblTournaments t ON td.tournament_id = t.id
            JOIN    
                tblRegions r ON p.region = r.id
            WHERE
                t.finalized = 1
            GROUP BY
                p.name,
                p.username,
                r.region
            ORDER BY
                player_rank